<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ClimateSafe+ (실시간) — 기후재난 경보</title>

<!-- 스타일: 글래스모피즘 + 그라디언트, 이미지 슬라이드 배경 -->
<style>
  :root{
    --accent: linear-gradient(135deg,#00C2FF 0%, #0072FF 50%, #4A00E0 100%);
    --glass: rgba(255,255,255,0.08);
    --glass-strong: rgba(255,255,255,0.12);
  }
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Noto Sans KR','Apple SD Gothic Neo',sans-serif;}
  body{
    background: #081229;
    color: #fff;
    overflow:hidden;
  }

  /* background slideshow */
  .bg {
    position:fixed; inset:0; z-index:0;
    display:block;
    background-size:cover; background-position:center;
    transition:opacity 1s ease-in-out;
    filter:brightness(0.55) saturate(1.1);
  }
  .bg.hidden{opacity:0; pointer-events:none}
  /* overlay gradient */
  .bg-overlay{
    position:fixed; inset:0; background:linear-gradient(180deg, rgba(8,18,41,0.25), rgba(8,18,41,0.6)); z-index:0;
  }

  .app {
    position:relative; z-index:2;
    max-width:980px; margin:32px auto; padding:28px;
    display:grid; grid-template-columns: 1fr 420px; gap:24px;
  }

  .card {
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
    border-radius:16px; padding:20px; box-shadow: 0 6px 30px rgba(0,0,0,0.6);
    backdrop-filter: blur(8px) saturate(120%);
    border: 1px solid rgba(255,255,255,0.06);
  }

  .hero {
    padding:36px; display:flex; flex-direction:column; justify-content:center;
  }
  h1{margin:0 0 8px; font-size:28px; letter-spacing:-0.4px;}
  p.lead{margin:0 0 18px; opacity:0.95}

  /* search */
  .search-row {display:flex; gap:12px; margin-top:8px;}
  input[type="text"]{
    flex:1; padding:14px 16px; border-radius:12px; border:none; outline:none;
    background: rgba(255,255,255,0.04); color:#fff; font-size:16px;
  }
  button.primary{
    padding:12px 18px; border-radius:12px; border:none; cursor:pointer;
    background: var(--accent); color:#fff; font-weight:600;
    box-shadow: 0 6px 20px rgba(74,0,224,0.18);
  }

  /* right column: weather card */
  .weather-card { display:flex; flex-direction:column; gap:12px;}
  .weather-top {display:flex; align-items:center; gap:12px;}
  .weather-icon {width:88px; height:88px; background:rgba(255,255,255,0.06); border-radius:14px; display:flex; align-items:center; justify-content:center; font-size:36px;}
  .temp {font-size:40px; font-weight:700;}
  .meta {opacity:0.9}

  /* warning */
  .warning {border-left:6px solid; padding:14px; border-radius:8px; background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}
  .warning.safe{border-color:#2bde73;color:#dfffe8;}
  .warning.caution{border-color:#ffd166;color:#fff9ea;}
  .warning.danger{border-color:#ff6b6b;color:#fff6f6;}

  /* responsive */
  @media(max-width:880px){
    .app{grid-template-columns:1fr; padding:18px;}
    .weather-card{order:2}
  }

  footer{position:fixed; left:12px; bottom:12px; z-index:3; color:rgba(255,255,255,0.7); font-size:13px}
</style>
</head>
<body>

<!-- background slides (Unsplash images) -->
<img class="bg" id="bg0" src="https://images.unsplash.com/photo-1501630834273-4b5604d2ee31?w=1600&q=80&auto=format&fit=crop" />
<img class="bg hidden" id="bg1" src="https://images.unsplash.com/photo-1501785888041-af3ef285b470?w=1600&q=80&auto=format&fit=crop" />
<img class="bg hidden" id="bg2" src="https://images.unsplash.com/photo-1503264116251-35a269479413?w=1600&q=80&auto=format&fit=crop" />

<div class="bg-overlay"></div>

<div class="app">
  <!-- left: hero + search -->
  <div class="card hero">
    <h1>ClimateSafe+ — 내 지역 기후재난 위험 확인</h1>
    <p class="lead">도시 이름을 입력하면 현재 기상과 (가능하면) 공식 경보를 불러와 위험도를 알려줍니다. <strong>경영·마케팅·국제정치</strong> 관점으로 해석 가능한 리스크 팁도 제공합니다.</p>
    <div class="search-row">
      <input id="cityInput" type="text" placeholder="예: 통영, Busan, Seoul" />
      <button class="primary" id="checkBtn">위험도 확인</button>
    </div>

    <div style="margin-top:18px; font-size:14px; opacity:0.9;">
      <strong>Tip.</strong> 정확한 결과를 위해 '도시명' 또는 '도시,국가' 형태 입력을 권장합니다. (예: "Tongyeong" 또는 "Seoul,KR")
    </div>
  </div>

  <!-- right: weather/result -->
  <div class="card weather-card" id="resultCard" aria-live="polite">
    <!-- initial placeholder -->
    <div style="text-align:center; opacity:0.9; padding:40px 20px;">
      <div style="font-size:22px; margin-bottom:8px;">검색 결과가 여기에 표시됩니다</div>
      <div style="font-size:13px; color:rgba(255,255,255,0.7)">실시간 API로 연동됩니다. (API 키 필요)</div>
    </div>
  </div>
</div>

<footer>Made for school project • Replace <code>YOUR_OPENWEATHERMAP_KEY_HERE</code> with your API key</footer>

<script>
/*
  핵심 로직:
  1) 도시명으로 OpenWeatherMap Geocoding(또는 Current Weather) 호출
  2) 위도/경도 얻어서 One Call(또는 Current) 호출 — alerts 포함 시 우선적으로 사용
  3) 경보(alerts)이 있으면 그걸 보여주고 없으면 threshold로 판단
  4) 결과 UI 업데이트 (색상/아이콘/메시지)
*/

/* ======= 설정: API 키(여기에 본인 키 넣기) ======= */
/* 경고: 클라이언트에 키를 직접 넣으면 노출됩니다. 데모용. */
const OWM_KEY = "YOUR_OPENWEATHERMAP_KEY_HERE";

/* 기본 이미지 슬라이드 */
const bgIds = ["bg0","bg1","bg2"];
let curBg = 0;
setInterval(()=> {
  const prev = curBg; curBg = (curBg+1)%bgIds.length;
  document.getElementById(bgIds[prev]).classList.add('hidden');
  document.getElementById(bgIds[curBg]).classList.remove('hidden');
}, 6000);

/* DOM */
const btn = document.getElementById('checkBtn');
const cityInput = document.getElementById('cityInput');
const resultCard = document.getElementById('resultCard');

btn.addEventListener('click', ()=> doCheck());

cityInput.addEventListener('keydown', (e)=> { if(e.key === 'Enter') doCheck(); });

async function doCheck(){
  const city = cityInput.value.trim();
  if(!city){ alert("지역을 입력해주세요"); return; }

  // show loading
  resultCard.innerHTML = `<div style="text-align:center; padding:30px;">불러오는 중…</div>`;

  try {
    // 1) 현재 날씨로 도시->좌표 가져오기 (Current Weather API)
    // API: https://api.openweathermap.org/data/2.5/weather?q={city}&appid={key}&units=metric&lang=kr
    const currUrl = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&appid=${OWM_KEY}&units=metric&lang=kr`;
    const currResp = await fetch(currUrl);
    if(!currResp.ok){
      const text = await currResp.text();
      throw new Error("위치 정보를 가져오지 못했습니다. (API 응답: " + currResp.status + ")");
    }
    const curr = await currResp.json();
    const { coord, weather, main, wind, name, sys } = curr;
    const lat = coord.lat, lon = coord.lon;

    // 2) One Call (alerts 포함) 시도 — v3.0 endpoint 예시
    // endpoint: https://api.openweathermap.org/data/3.0/onecall?lat={lat}&lon={lon}&appid={key}&units=metric&exclude=minutely
    let alerts = null;
    let onecallData = null;
    try {
      const ocUrl = `https://api.openweathermap.org/data/3.0/onecall?lat=${lat}&lon=${lon}&appid=${OWM_KEY}&units=metric&exclude=minutely`;
      const ocResp = await fetch(ocUrl);
      if(ocResp.ok){
        onecallData = await ocResp.json();
        if(onecallData.alerts && onecallData.alerts.length) alerts = onecallData.alerts;
      } else {
        // One Call 호출 실패(권한/요금문제 등) — 무시하고 계속 (내부 판단 사용)
        // console.warn("One Call failed", ocResp.status);
      }
    } catch(e){
      // 네트워크/권한 에러 — 무시하고 계속
      // console.warn("One Call error", e);
    }

    // 3) 위험 판단: alerts 우선, 없으면 자체 임계값으로 판단
    let level = "안정적";
    let levelClass = "safe";
    let message = "현재 공식 경보는 없습니다. 일반적인 안전 수칙을 확인하세요.";
    if(alerts && alerts.length){
      // 가장 긴급한 alert 사용 (여기선 첫번째)
      const a = alerts[0];
      level = "매우 위험";
      levelClass = "danger";
      message = `<strong>${a.event}</strong> — ${a.description || a.sender_name || ''}`;
    } else {
      // 자체 판단
      const temp = main.temp;
      const wind_kph = wind.speed * 3.6; // m/s -> km/h
      const rain = (onecallData && onecallData.current && onecallData.current.rain) || 0; // mm
      if ((rain && rain > 10) || wind_kph > 60) {
        level = "매우 위험";
        levelClass = "danger";
        message = "폭우/강풍 위험. 즉시 실내로 대피하고 안전한 장소로 이동하세요.";
      } else if (temp >= 33 || wind_kph > 30) {
        level = "주의";
        levelClass = "caution";
        message = temp >= 33 ? "폭염 주의: 충분한 수분 섭취 및 야외활동 자제." : "강풍 주의: 실외 물건 고정 및 안전 유의.";
      } else {
        level = "안정적";
        levelClass = "safe";
        message = "현재 큰 위험은 없습니다. 기상 정보 모니터링을 권장합니다.";
      }
    }

    // 4) UI 그리기
    const icon = weather && weather[0] && weather[0].icon ? `https://openweathermap.org/img/wn/${weather[0].icon}@2x.png` : '';
    resultCard.innerHTML = `
      <div style="display:flex; gap:12px; align-items:center;">
        <div class="weather-icon">${ icon ? `<img src="${icon}" alt="icon" style="width:72px;height:72px">` : "☁️" }</div>
        <div>
          <div style="font-size:12px; opacity:0.9">${name}${sys && sys.country ? ", "+sys.country : ""}</div>
          <div class="temp">${Math.round(main.temp)}°C</div>
          <div class="meta">체감 ${Math.round(main.feels_like)}°C • 습도 ${main.humidity}% • 풍속 ${Math.round(wind.speed*3.6)} km/h</div>
        </div>
      </div>

      <div style="margin-top:14px;" class="warning ${ levelClass === 'danger' ? 'danger' : (levelClass === 'caution' ? 'caution' : 'safe') }">
        <div style="font-weight:700; margin-bottom:6px;">기후 위험도 — ${level}</div>
        <div style="font-size:14px;">${message}</div>
      </div>

      <div style="margin-top:12px; font-size:13px; opacity:0.9;">
        <strong>전공별 리스크 팁</strong>
        <ul style="margin:8px 0 0 18px; padding:0;">
          <li><strong>경영:</strong> 공급망·프로덕션 차질 대비 비상 매뉴얼 점검</li>
          <li><strong>마케팅:</strong> 고객 커뮤니케이션(배송 지연 안내 등) 준비</li>
          <li><strong>국제정치:</strong> 지역 재난 정보는 국제 협력·지원 요청의 기초 자료</li>
        </ul>
      </div>

      <div style="margin-top:12px; font-size:12px; opacity:0.8;">
        (데모: OpenWeatherMap API 기반. 실제 경보는 관할 기관 지침을 최우선으로 따르세요.)
      </div>
    `;

  } catch(err){
    resultCard.innerHTML = `<div style="padding:20px; color:#ffdcdc;">에러: ${err.message}</div>`;
  }
}
</script>
</body>
</html>
